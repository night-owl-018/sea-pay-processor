<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ATGSD Sea Pay Processor</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="container">
    <h1>ATGSD Sea Pay Processor</h1>

    <form id="uploadForm" action="/process" method="POST" enctype="multipart/form-data">

        <label>Upload TORIS Sea Duty Certification Sheets (PDF):</label>
        <input type="file" name="files" multiple required>

        <label>Upload Custom NAVPERS 1070/613 Template (optional):</label>
        <p>Current active template: {{ template_path }}</p>
        <input type="file" name="template_file">

        <label>Upload N811 CSV (optional):</label>
        <p>Current active CSV: {{ rate_path }}</p>
        <input type="file" name="rate_file">

        <label>Select Strikeout Color:</label>
        <select name="strike_color">
            <option value="black" selected>Black</option>
            <option value="red">Red</option>
        </select>

        <button type="button" id="runBtn">RUN PROCESSOR</button>
    </form>


    <div class="button-row">
        <a href="/download_merged" class="btn">MERGED SEA PAY PG13</a>
        <a href="/download_summary" class="btn">MERGED SUMMARY</a>
        <a href="/download_marked_sheets" class="btn">TORIS Sea Pay Cert Sheets</a>
        <a href="/download_tracking" class="btn">TRACKER FILE</a>
        <a href="/download_all" class="btn">EXPORT ZIP</a>
        <button id="resetBtn" class="btn danger">RESET ALL</button>
    </div>

    <h3>Live Logs</h3>
    <textarea id="logBox" readonly></textarea>
</div>

<script>
document.getElementById("runBtn").onclick = function () {
    const formData = new FormData(document.getElementById("uploadForm"));
    fetch("/process", {
        method: "POST",
        body: formData
    }).then(r => r.json()).then(data => {
        console.log(data);
    });
};

function updateLogs() {
    fetch("/logs").then(response => response.text()).then(text => {
        document.getElementById("logBox").value = text;
    });
}
setInterval(updateLogs, 2000);

document.getElementById("resetBtn").onclick = function () {
    fetch("/reset", {method: "POST"})
        .then(r => r.json())
        .then(() => location.reload());
};
</script>

</body>
</html>
