<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ATGSD SEA PAY PROCESSOR</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        background-color: #0f0f10;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial;
        color: #e6e6e6;
        margin: 0;
        padding: 20px;
    }

    h1 {
        text-align: center;
        margin-bottom: 28px;
        color: #ffffff;
        font-weight: 600;
    }

    h2 {
        margin-top: 0;
        font-weight: 600;
        color: #ffffff;
        font-size: 1.05em;
    }

    .container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
    }

    .card {
        background: #1a1b1e;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 0 12px rgba(0,0,0,0.4);
    }

    label {
        font-size: 0.9em;
        margin-bottom: 6px;
        display: block;
    }

    input[type="file"],
    select {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        background: #2a2b2f;
        border: 1px solid #3a3b3f;
        color: #ffffff;
    }

    button {
        background-color: #007aff;
        color: white;
        border: none;
        padding: 10px 16px;
        margin-top: 12px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 0.95em;
        transition: 0.15s ease;
    }

    button:hover {
        background-color: #0a84ff;
    }

    .danger {
        background-color: #ff453a;
    }
    .danger:hover {
        background-color: #ff5e57;
    }

    .download-row {
        margin-top: 15px;
        display: flex;
        gap: 12px;
        align-items: center;
    }

    .download-row select {
        width: 260px;
    }

    /* STATUS COLORS */
    .status-blue {
        color: #4da3ff !important;
        font-weight: 600;
    }
    .status-red {
        color: #ff453a !important;
        font-weight: 600;
    }
    .status-green {
        color: #30d158 !important;
        font-weight: 600;
    }

    /* LOG PANEL */
    .log-card {
        margin-top: 25px;
        grid-column: span 2;
        background: #1a1b1e;
        padding: 20px;
        border-radius: 12px;
    }

    #logBox {
        height: 260px;
        background: #0c0c0d;
        border: 1px solid #2a2b2f;
        padding: 12px;
        border-radius: 8px;
        font-family: monospace;
        font-size: 0.9em;
        overflow-y: scroll;
        white-space: pre-line;
    }

    footer {
        text-align: center;
        margin-top: 20px;
        opacity: 0.6;
        font-size: 0.85em;
    }
</style>

</head>
<body>

<h1>ATGSD SEA PAY PROCESSOR</h1>

<div class="container">

    <!-- LEFT: TORIS SHEETS -->
    <div class="card">
        <h2>TORIS Sheets (PDF)</h2>
        <label>Select PDF Files:</label>
        <input type="file" id="files" name="files" multiple accept="application/pdf">
    </div>

    <!-- RIGHT: PROCESS CONTROL -->
    <div class="card">
        <h2>Process Control</h2>

        <label>Strikeout Color:</label>
        <select id="strikeColor">
            <option value="black">Black</option>
            <option value="red">Red</option>
            <option value="blue">Blue</option>
        </select>

        <button id="runBtn">Run Processor</button>

        <div class="download-row">
            <select id="downloadSelect">
                <option value="">Select Output...</option>
                <option value="/download_merged">Merged SEA PAY PG13</option>
                <option value="/download_summary">Merged Summary</option>
                <option value="/download_marked_sheets">TORIS Marked Sheets</option>
                <option value="/download_tracking">Tracker File</option>
                <option value="/download_all">Export ZIP</option>
            </select>

            <button id="downloadBtn" style="display:none;">Download</button>
        </div>

        <button class="danger" id="resetBtn">Reset System</button>

        <div id="statusText" class="status-blue" style="margin-top:12px;">
            STATUS: READY
        </div>
    </div>

</div>

<!-- LOG PANEL -->
<div class="log-card">
    <h2>Live Operation Log</h2>
    <div id="logBox">Waiting...</div>
</div>

<footer>
    STG1(SW) Nivera, Ryan | ATGSD
</footer>

<script>
/* -------------------------
   DOWNLOAD SELECTOR LOGIC
--------------------------*/
document.getElementById("downloadSelect").addEventListener("change", function () {
    const btn = document.getElementById("downloadBtn");
    btn.style.display = this.value ? "inline-block" : "none";
});

document.getElementById("downloadBtn").onclick = () => {
    const val = document.getElementById("downloadSelect").value;
    if (val) window.location.href = val;
};


/* -------------------------
   STATUS CONTROL
--------------------------*/
const statusBox = document.getElementById("statusText");

function setStatusReady() {
    statusBox.className = "status-blue";
    statusBox.innerText = "STATUS: READY";
}

function setStatusProcessing() {
    statusBox.className = "status-red";
    statusBox.innerText = "STATUS: PROCESSING...";
}

function setStatusComplete() {
    statusBox.className = "status-green";
    statusBox.innerText = "STATUS: COMPLETE";
}


/* RUN PROCESSOR */
document.getElementById("runBtn").onclick = () => {
    setStatusProcessing();
    window.location.href = "/";
};

/* RESET SYSTEM */
document.getElementById("resetBtn").onclick = () => {
    fetch("/reset")
        .then(() => setStatusReady());
};


/* -------------------------
   LIVE LOG UPDATES
--------------------------*/
function updateLogs() {
    fetch("/logs")
        .then(r => r.text())
        .then(text => {
            document.getElementById("logBox").textContent = text;
            const box = document.getElementById("logBox");
            box.scrollTop = box.scrollHeight;
        });
}
setInterval(updateLogs, 1000);
</script>

</body>
</html>
